from google.appengine.ext import db
from google.appengine.tools import bulkloader

#sys.path.append('../..')
import models

# want an accuracy of 8 (address level)

class VenueLoader(bulkloader.Loader):
	def __init__(self): 
		def lat_lon(s): 
			lat, lon = [float(v) for v in s.split('|')]
			return db.GeoPt(lat, lon)

		bulkloader.Loader.__init__(self, 'Venue',
			[('name', str), 
			 ('location',lat_lon), 
			])

	#def create_entity(self, values, key_name=None, parent=None):
	# Set the 15th column as the 15th,16th column (lat/lon)
	# so that we can set one property (location:GeoPt) from two
	# CSV columns.
	#values[2] = values[2] + ',' + values[3]
	#
	#return super(VenueLoader, self).create_entity(values, key_name)

	def handle_entity(self, entity):
		entity.update_location()
		return entity

loaders = [VenueLoader]
